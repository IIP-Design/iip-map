let map,googleKey=iip_map_params.google_api_key,map_id=iip_map_params.map_id,zoom=iip_map_params.map_zoom,lat=iip_map_params.map_center_lat,lng=iip_map_params.map_center_lng;function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(lat),lng:parseFloat(lng)},zoom:parseInt(zoom)});let e="/wp-json/iip-map/v1/maps/"+map_id,t=new XMLHttpRequest;t.open("GET",e),t.responseType="json",t.send(),t.onload=function(){let e=t.response;t.statusText;plotMarkers(e)}}document.addEventListener("DOMContentLoaded",function(){if(document.querySelectorAll("#map").length>0){let e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key="+googleKey+"&callback=initMap",document.getElementsByTagName("head")[0].appendChild(e)}});let markers=[];function plotMarkers(e){let t=new google.maps.InfoWindow,n=new OverlappingMarkerSpiderfier(map,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0});e.forEach(function(e){let a=new google.maps.LatLng(parseFloat(e.lat),parseFloat(e.lng)),o=new google.maps.Marker({position:a});null!==e.event_topic&&""!==e.event_topic?topicLine='<h3 class="iip-map-infowin-header">Topic: '+e.event_topic+"</h3>":topicLine="<div></div>",null!==e.event_duration&&""!==e.event_duration?durationLine="Estimated duration: "+e.event_duration+"</p>":durationLine="",null!==e.host_name&&""!==e.host_name?hostLine=e.host_name:hostLine="",null!==e.contact&&""!==e.contact?contactLine=e.contact:contactLine="",""!==hostLine&&""!==contactLine?contactBlock='<h3 class="iip-map-infowin-header">Contact: </h3><p>'+hostLine+"<br />"+contactLine+"</p>":""===hostLine&&""!==contactLine?contactBlock='<h3 class="iip-map-infowin-header">Contact: </h3><p>'+contactLine+"</p>":""!==hostLine&&""===contactLine?contactBlock='<h3 class="iip-map-infowin-header">Contact: </h3><p>'+hostLine+"</p>":contactBlock="";let i=new Date(e.event_date+" "+e.event_time),p=i.getDate(),s=i.toLocaleString("en-us",{month:"long"})+" "+p,c=i.getHours()+":"+i.getMinutes(),m='<div id="infowindow-'+e.id+'"><h1 id="firstHeading" class="iip-map-infowin-header">'+e.event_name+' </h1><div id="bodyContent" class="iip-map-infowin-body">'+topicLine+"<p>"+e.event_desc+'</p><h3 class="iip-map-infowin-header">When: </h3><p> On '+s+" at "+c+". <br />"+durationLine+'<h3 class="iip-map-infowin-header">Where: </h3><p>'+e.venue_name+"<br />"+e.venue_city+"<br />"+contactBlock+"</div></div>";google.maps.event.addListener(o,"click",function(e){map.panTo(o.getPosition()),t.setContent(m),t.open(map,o)}),google.maps.event.addListener(map,"click",function(e){t.close()}),markers.push(o),n.addMarker(o)}),new MarkerClusterer(map,markers,{imagePath:"/wp-content/plugins/iip-map/static/m"}).setMaxZoom(15)}