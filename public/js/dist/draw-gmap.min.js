let map,googleKey=iip_map_params.google_api_key,map_id=iip_map_params.map_id,zoom=iip_map_params.map_zoom,lat=iip_map_params.map_center_lat,lng=iip_map_params.map_center_lng;function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(lat),lng:parseFloat(lng)},zoom:parseInt(zoom)});let e="/wp-json/iip-map/v1/maps/"+map_id,a=new XMLHttpRequest;a.open("GET",e),a.responseType="json",a.send(),a.onload=function(){let e=a.response;a.statusText;plotMarkers(e)}}document.addEventListener("DOMContentLoaded",function(){if(document.querySelectorAll("#map").length>0){let e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key="+googleKey+"&callback=initMap",document.getElementsByTagName("head")[0].appendChild(e)}});let markers=[];function plotMarkers(e){let a=new google.maps.InfoWindow,t=new OverlappingMarkerSpiderfier(map,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0});e.forEach(function(e){let n=new google.maps.LatLng(parseFloat(e.lat),parseFloat(e.lng)),o=new google.maps.Marker({position:n});null!==e.event_topic?topicLine='<h3 class="iip-map-infowin-header">Topic: '+e.event_topic+"</h3>":topicLine="<div></div>",null!==e.host_name?hostLine="Hosted by: "+e.host_name+"<br />":hostLine="",null!==e.contact&&""!==e.contact?contactLine="Contact: "+e.contact:contactLine="";let i=new Date(e.event_date),p=i.getDate(),s=i.toLocaleString("en-us",{month:"long"})+" "+p,m='<div id="infowindow-'+e.id+'"><h1 id="firstHeading" class="iip-map-infowin-header">'+e.event_name+' </h1><div id="bodyContent" class="iip-map-infowin-body">'+topicLine+"<p>"+e.event_desc+'</p><h3 class="iip-map-infowin-header">When: </h3><p> On '+s+" at "+e.event_time+". <br />Estimated duration: "+e.event_duration+'</p><h3 class="iip-map-infowin-header">Where: </h3><p>'+hostLine+e.venue_address+"<br />"+e.venue_city+"<br />"+contactLine+"</p></div></div>";google.maps.event.addListener(o,"click",function(e){a.setContent(m),a.open(map,o)}),google.maps.event.addListener(map,"click",function(e){a.close()}),markers.push(o),t.addMarker(o)}),new MarkerClusterer(map,markers,{imagePath:"/wp-content/plugins/iip-map/images/m"}).setMaxZoom(15)}