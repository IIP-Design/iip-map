let map,googleKey=iip_map_params.google_api_key,map_id=iip_map_params.map_id,zoom=iip_map_params.map_zoom,lat=iip_map_params.map_center_lat,lng=iip_map_params.map_center_lng;function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(lat),lng:parseFloat(lng)},zoom:parseInt(zoom)}),fetch("/wp-json/iip-map/v1/map/"+map_id).then(function(e){return e.json()}).then(plotMarkers)}document.addEventListener("DOMContentLoaded",function(){if(document.querySelectorAll("#map").length>0){let e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key="+googleKey+"&callback=initMap",document.getElementsByTagName("head")[0].appendChild(e)}});let markers=[];function plotMarkers(e){let a=new google.maps.InfoWindow,t=new OverlappingMarkerSpiderfier(map,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0});e.forEach(function(e){e.forEach(function(e,n){let i=new google.maps.LatLng(parseFloat(e.lat),parseFloat(e.lng)),p=new google.maps.Marker({position:i});null!==e.event_topic?topicLine='<h3 class="iip-map-infowin-header">Topic: '+e.event_topic+"</h3>":topicLine="<div></div>";let o='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="iip-map-infowin-header">'+e.event_name+' </h1><div id="bodyContent" class="iip-map-infowin-body">'+topicLine+"<p>"+e.event_desc+'</p><h3 class="iip-map-infowin-header">When: </h3><p> On '+e.event_date+" at "+e.event_time+". <br />Estimated duration: "+e.event_duration+'</p><h3 class="iip-map-infowin-header">Where: </h3><p>'+e.venue_name+"<br />"+e.venue_address+"<br />"+e.venue_city+"<br />Contact: "+e.contact+"<br /></div></div>";google.maps.event.addListener(p,"click",function(e){a.setContent(o),a.open(map,p)}),markers.push(p),t.addMarker(p)})}),new MarkerClusterer(map,markers,{imagePath:"/wp-content/plugins/iip-map/images/m"}).setMaxZoom(15)}