let map_id=iip_map_params.map_id,zoom=iip_map_params.map_zoom,lat=iip_map_params.map_center_lat,lng=iip_map_params.map_center_lng,mapDataEndpoint="/wp-json/iip-map/v1/maps/"+map_id,mapDataXHR=new XMLHttpRequest;mapDataXHR.open("GET",mapDataEndpoint),mapDataXHR.responseType="json",mapDataXHR.send(),mapDataXHR.onload=function(){let e=mapDataXHR.response;mapDataXHR.statusText;plotMarkers(e)};const markerSource=new ol.source.Vector;let markerStyle=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:.75,src:"/wp-content/plugins/iip-map/images/map-pin.png"})}),clusterSource=new ol.source.Cluster({distance:50,source:markerSource}),styleCache={};function clusterStyle(e){let t=e.get("features").length,o=styleCache[t];return o||(o=new ol.style.Style({image:new ol.style.Circle({radius:15,stroke:new ol.style.Stroke({color:"#fff"}),fill:new ol.style.Fill({color:"#0081FF"})}),text:new ol.style.Text({text:t.toString(),fill:new ol.style.Fill({color:"#fff"})})}),styleCache[t]=o),o}let baseLayer=new ol.layer.Tile({source:new ol.source.OSM}),clusterLayer=new ol.layer.Vector({source:clusterSource,style:clusterStyle}),markerLayer=new ol.layer.Vector({source:clusterSource,style:markerStyle}),map=new ol.Map({target:"map",controls:ol.control.defaults({attributionOptions:{collapsible:!0}}),layers:[baseLayer,clusterLayer],view:new ol.View({center:ol.proj.fromLonLat([parseFloat(lng),parseFloat(lat)]),zoom:parseInt(zoom)})});function plotMarkers(e){e.forEach(function(e){let t=[parseFloat(e.lng),parseFloat(e.lat)];null!==e.event_topic?topicLine='<h3 class="iip-map-ol-popup-header">Topic: '+e.event_topic+"</h3>":topicLine="<div></div>",null!==e.host_name?hostLine="Hosted by: "+e.host_name+"<br />":hostLine="",null!==e.contact&&""!==e.contact?contactLine="Contact: "+e.contact:contactLine="";let o=new Date(e.event_date),n=o.getDate(),a=o.toLocaleString("en-us",{month:"long"})+" "+n,r='<div id="bodyContent-'+e.id+'" class="iip-map-ol-popup-body">'+topicLine+"<p>"+e.event_desc+'</p><h3 class="iip-map-ol-popup-header">When: </h3><p> On '+a+" at "+e.event_time+". <br />Estimated duration: "+e.event_duration+'</p><h3 class="iip-map-ol-popup-header">Where: </h3><p>'+hostLine+e.venue_address+"<br />"+e.venue_city+"<br />"+contactLine+"</p></div>",l='<div class="iip-map-ol-popup" id="infowindow-'+e.id+'"><h1 id="firstHeading" class="iip-map-ol-popup-header">'+e.event_name+" </h1>"+r+"</div>";var i=new ol.Feature({content:l,geometry:new ol.geom.Point(ol.proj.transform(t,"EPSG:4326","EPSG:3857")),id:e.id,text:r,title:e.event_name});markerSource.addFeature(i)})}map.on("click",function(e){let t=new Popup;map.addOverlay(t);let o=map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(o){let r=e.coordinate,l=o.get("features"),i=l[0].N.content,c=l.length;if(1===c)t.show(r,i);else{let e=document.createElement("div");e.className="iip-map-ol-popup";for(var n=0;n<c;n++){let t=l[n].N.id,o='<div class="marker-accordion closed">'+('<h1 class="marker-event-title iip-map-ol-popup-header" id="title-marker-'+t+'">'+l[n].N.title+"</h1>")+('<div class="marker-text" id="text-marker-'+t+'">'+l[n].N.text+"</div>")+"</div>";e.insertAdjacentHTML("afterbegin",o)}t.show(r,e);let o=document.getElementsByClassName("marker-accordion"),i=document.getElementsByClassName("marker-event-title");for(n=0;n<i.length;n++)i[n].addEventListener("click",a,!1);function a(){let e=this.parentNode.className;for(var t=0;t<o.length;t++)o[t].className="marker-accordion closed";"marker-accordion closed"==e&&(this.parentNode.className="marker-accordion opened")}}}else o||t.hide()}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ol/overlay")):"function"==typeof define&&define.amd?define(["ol/overlay"],t):e.Popup=t(e.ol.Overlay)}(this,function(e){"use strict";e="default"in e?e.default:e;var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(a){function r(e){t(this,r);var o=e||{};void 0===o.autoPan&&(o.autoPan=!0),void 0===o.autoPanAnimation&&(o.autoPanAnimation={duration:250});var a=document.createElement("div");o.element=a;var l=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,o));l.container=a,l.container.className="ol-popup",l.closer=document.createElement("a"),l.closer.className="ol-popup-closer",l.closer.href="#",l.container.appendChild(l.closer);var i=l;return l.closer.addEventListener("click",function(e){i.container.style.display="none",i.closer.blur(),e.preventDefault()},!1),l.content=document.createElement("div"),l.content.className="ol-popup-content",l.container.appendChild(l.content),r.enableTouchScroll_(l.content),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),o(r,[{key:"show",value:function(e,t){return t instanceof HTMLElement?(this.content.innerHTML="",this.content.appendChild(t)):this.content.innerHTML=t,this.container.style.display="block",this.content.scrollTop=0,this.setPosition(e),this}},{key:"hide",value:function(){return this.container.style.display="none",this}},{key:"isOpened",value:function(){return"block"==this.container.style.display}}],[{key:"isTouchDevice_",value:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}},{key:"enableTouchScroll_",value:function(e){if(r.isTouchDevice_()){var t=0;e.addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),e.addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}}}]),r}();return window.ol&&window.ol.Overlay&&(window.ol.Overlay.Popup=a),a});